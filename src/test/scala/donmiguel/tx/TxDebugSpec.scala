package donmiguel.tx

import donmiguel.UnitSpec
import donmiguel.util.CryptoUtil

class TxDebugSpec extends UnitSpec{

  it should "sign_input" in {

    TxFetcher.load("tx.cache")

    val private_key = new PrivateKey(8675309)
    //version: 01000000
    //num_in: 01
    //prev_tx: 99a24308080ab26e6fb65c4eccfadf76749bb5bfa8cb08f291320b3c21e56f0d
    //prev_idx: 0d
    //script_length:0
    //len: 20
    //op: 118
    //op: 169
    //len: 20
    //data: d52ad7ca9b3d096a38e752c2018e6fbc40cdf26f / 507b27411ccf7f16f10297de6cef3f291623eddf
    //op: 136
    //op: 172
    val tx= Tx.parse(CryptoUtil.hexToBytes("010000000199a24308080ab26e6fb65c4eccfadf76749bb5bfa8cb08f291320b3c21e56f0d0d00000000ffffffff02408af701000000001976a914d52ad7ca9b3d096a38e752c2018e6fbc40cdf26f88ac80969800000000001976a914507b27411ccf7f16f10297de6cef3f291623eddf88ac00000000").iterator)

    //diff actual:   c49304602210037322c03704d69e382c36035cd4d13da9ee09c4108ba2e3b0b5877ed22bf0ec30221002dad6b88d3be99a521c2e63c8c9a5ad28c8913af2c2c167319f6d60612d93903012103935581e52c354cd2f484fe8ed83af7a3097005b2f9c60bff71d35bd795f54b67ffffffff00000000
    //diff expected: b4830450221008ed46aa2cf12d6d81065bfabe903670165b538f65ee9a3385e6327d80c66d3b502203124f804410527497329ec4715e18558082d489b218677bd029e7fa306a722360  12103935581e52c354cd2f484fe8ed83af7a3097005b2f9c60bff71d35bd795f54b67ffffffff

    assert (tx.sing_input(0,private_key)==true )

    //FIXME
    assert(CryptoUtil.bytesToHex(tx.serialize)== "010000000199a24308080ab26e6fb65c4eccfadf76749bb5bfa8cb08f291320b3c21e56f0d0d0000006b4830450221008ed46aa2cf12d6d81065bfabe903670165b538f65ee9a3385e6327d80c66d3b502203124f804410527497329ec4715e18558082d489b218677bd029e7fa306a72236012103935581e52c354cd2f484fe8ed83af7a3097005b2f9c60bff71d35bd795f54b67ffffffff02408af701000000001976a914d52ad7ca9b3d096a38e752c2018e6fbc40cdf26f88ac80969800000000001976a914507b27411ccf7f16f10297de6cef3f291623eddf88ac00000000")

  }
}
